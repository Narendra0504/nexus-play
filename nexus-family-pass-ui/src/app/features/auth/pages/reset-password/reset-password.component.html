<!-- 
  =====================================================
  NEXUS FAMILY PASS - RESET PASSWORD TEMPLATE
  Form for setting a new password with strength
  indicator and requirements checklist
  =====================================================
-->

<!-- Main container with gradient background -->
<div class="reset-password-container min-h-screen flex items-center justify-center p-4">
  
  <!-- Card wrapper -->
  <mat-card class="reset-password-card w-full max-w-md">
    <mat-card-content class="p-6 sm:p-8">
      
      <!-- Back to login link -->
      <a 
        routerLink="/login" 
        class="back-link inline-flex items-center text-neutral-500 
               hover:text-primary-500 mb-6 transition-colors">
        <mat-icon class="mr-1">arrow_back</mat-icon>
        <span class="text-sm">Back to login</span>
      </a>
      
      <!-- Header section with icon and title -->
      <div class="text-center mb-6">
        <!-- Lock icon in circle -->
        <div class="mx-auto mb-4 w-16 h-16 rounded-full bg-primary-500/10 
                    flex items-center justify-center">
          <mat-icon class="text-primary-500 text-3xl">lock</mat-icon>
        </div>
        
        <!-- Page title -->
        <h1 class="text-2xl font-semibold text-neutral-800 mb-2">
          Create new password
        </h1>
        
        <!-- Description -->
        <p class="text-neutral-500">
          Your new password must be different from previous passwords
        </p>
      </div>
      
      <!-- Reset password form -->
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
        
        <!-- New Password Field -->
        <mat-form-field appearance="outline" class="w-full mb-2">
          <mat-label>New password</mat-label>
          
          <!-- Password input with dynamic type for visibility toggle -->
          <input 
            matInput 
            [type]="hidePassword() ? 'password' : 'text'"
            formControlName="newPassword"
            placeholder="Enter your new password"
            autocomplete="new-password">
          
          <!-- Lock icon prefix -->
          <mat-icon matPrefix class="text-neutral-400 mr-2">lock</mat-icon>
          
          <!-- Visibility toggle button -->
          <button 
            type="button"
            mat-icon-button 
            matSuffix 
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="hidePassword() ? 'Show password' : 'Hide password'">
            <mat-icon class="text-neutral-400">
              {{ hidePassword() ? 'visibility_off' : 'visibility' }}
            </mat-icon>
          </button>
          
          <!-- Validation error messages -->
          <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('required')">
            Password is required
          </mat-error>
          <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('minlength')">
            Password must be at least 8 characters
          </mat-error>
        </mat-form-field>
        
        <!-- 
          Password Strength Indicator
          Shows visual progress bar and label
          Only visible when password has value
        -->
        <div 
          *ngIf="resetPasswordForm.get('newPassword')?.value" 
          class="password-strength mb-4">
          
          <!-- Strength label and value -->
          <div class="flex justify-between items-center mb-1">
            <span class="text-xs text-neutral-500">Password strength</span>
            <span 
              class="text-xs font-medium"
              [ngClass]="{
                'text-danger-500': passwordStrength() <= 40,
                'text-warning-500': passwordStrength() > 40 && passwordStrength() <= 60,
                'text-success-500': passwordStrength() > 60
              }">
              {{ strengthLabel() }}
            </span>
          </div>
          
          <!-- Progress bar showing strength -->
          <mat-progress-bar 
            mode="determinate" 
            [value]="passwordStrength()"
            [color]="strengthColor()">
          </mat-progress-bar>
        </div>
        
        <!-- 
          Password Requirements Checklist
          Shows which requirements are met with checkmarks
        -->
        <div class="requirements-checklist mb-6 p-4 bg-neutral-50 rounded-lg">
          <p class="text-xs text-neutral-500 mb-3 font-medium uppercase tracking-wide">
            Password must contain:
          </p>
          
          <!-- List of requirements -->
          <ul class="space-y-2">
            <!-- Loop through requirements -->
            <li 
              *ngFor="let req of passwordRequirements"
              class="flex items-center gap-2 text-sm"
              [ngClass]="req.met ? 'text-success-500' : 'text-neutral-400'">
              
              <!-- Checkmark or circle icon based on met status -->
              <mat-icon class="text-base w-4 h-4">
                {{ req.met ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              
              <!-- Requirement label -->
              <span>{{ req.label }}</span>
            </li>
          </ul>
        </div>
        
        <!-- Confirm Password Field -->
        <mat-form-field appearance="outline" class="w-full mb-6">
          <mat-label>Confirm password</mat-label>
          
          <!-- Confirm password input -->
          <input 
            matInput 
            [type]="hideConfirmPassword() ? 'password' : 'text'"
            formControlName="confirmPassword"
            placeholder="Confirm your new password"
            autocomplete="new-password">
          
          <!-- Lock icon prefix -->
          <mat-icon matPrefix class="text-neutral-400 mr-2">lock</mat-icon>
          
          <!-- Visibility toggle -->
          <button 
            type="button"
            mat-icon-button 
            matSuffix 
            (click)="toggleConfirmPasswordVisibility()"
            [attr.aria-label]="hideConfirmPassword() ? 'Show password' : 'Hide password'">
            <mat-icon class="text-neutral-400">
              {{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}
            </mat-icon>
          </button>
          
          <!-- Validation errors -->
          <mat-error *ngIf="resetPasswordForm.get('confirmPassword')?.hasError('required')">
            Please confirm your password
          </mat-error>
          <mat-error *ngIf="resetPasswordForm.get('confirmPassword')?.hasError('passwordMismatch')">
            Passwords do not match
          </mat-error>
        </mat-form-field>
        
        <!-- Submit Button -->
        <button 
          mat-raised-button 
          color="primary"
          type="submit"
          class="w-full h-12"
          [disabled]="isLoading() || resetPasswordForm.invalid">
          
          <!-- Conditional content -->
          <ng-container *ngIf="!isLoading(); else loadingSpinner">
            Reset Password
          </ng-container>
          
          <!-- Loading spinner -->
          <ng-template #loadingSpinner>
            <mat-spinner diameter="24" class="mx-auto"></mat-spinner>
          </ng-template>
        </button>
      </form>
      
    </mat-card-content>
  </mat-card>
</div>
