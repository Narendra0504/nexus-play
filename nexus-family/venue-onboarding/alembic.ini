# =============================================================================
# NEXUS FAMILY PASS - ALEMBIC CONFIGURATION
# =============================================================================
# Alembic is the database migration tool for SQLAlchemy.
# This file configures how migrations are generated and applied.
#
# Usage:
#   alembic upgrade head      - Apply all pending migrations
#   alembic downgrade -1      - Rollback one migration
#   alembic revision -m "msg" - Create new migration
#   alembic history           - Show migration history
# =============================================================================

[alembic]
# =============================================================================
# CORE CONFIGURATION
# =============================================================================

# Path to migration scripts directory
# This is where all migration version files are stored
script_location = alembic

# Template used to generate migration scripts
# Default: %(rev)s_%(slug)s.py
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s

# Truncate the 'slug' portion of the filename at this length
# Helps keep filenames manageable
truncate_slug_length = 40

# Set to 'true' to run the environment during generation
# of a migration script. This is useful if environment-level
# customizations need to be applied when generating scripts.
# IMPORTANT: We set this to false for security (don't run env during autogen)
prepend_sys_path = .

# Timezone to use when generating timestamps for migrations
# Using UTC for consistency across deployments
timezone = UTC

# Version path separator
# On Windows: use ; (semicolon)
# On Unix: use : (colon)
version_path_separator = os

# =============================================================================
# DATABASE URL
# =============================================================================
# The SQLAlchemy database URL
# 
# IMPORTANT: In production, this should be set via environment variable.
# The actual URL is loaded in alembic/env.py from the environment.
# This placeholder is here as documentation.
#
# Format: postgresql://[user]:[password]@[host]:[port]/[database]
#
# Example for Supabase:
# sqlalchemy.url = postgresql://postgres:password@db.xxx.supabase.co:5432/postgres

# Leaving this empty because we load from environment in env.py
sqlalchemy.url = 

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# Configure Python logging for Alembic

[loggers]
# List of loggers to configure
keys = root,sqlalchemy,alembic

[handlers]
# List of handlers
keys = console

[formatters]
# List of formatters
keys = generic

# -----------------------------------------------------------------------------
# ROOT LOGGER
# -----------------------------------------------------------------------------
[logger_root]
# Root logger level - INFO shows migration progress
level = INFO
handlers = console
qualname =

# -----------------------------------------------------------------------------
# SQLALCHEMY LOGGER
# -----------------------------------------------------------------------------
[logger_sqlalchemy]
# SQLAlchemy logger - WARNING reduces noise during migrations
# Set to INFO or DEBUG to see SQL statements being executed
level = WARN
handlers =
qualname = sqlalchemy.engine

# -----------------------------------------------------------------------------
# ALEMBIC LOGGER
# -----------------------------------------------------------------------------
[logger_alembic]
# Alembic logger - INFO shows migration operations
level = INFO
handlers =
qualname = alembic

# -----------------------------------------------------------------------------
# CONSOLE HANDLER
# -----------------------------------------------------------------------------
[handler_console]
# Output to stdout
class = StreamHandler
args = (sys.stdout,)
level = NOTSET
formatter = generic

# -----------------------------------------------------------------------------
# LOG FORMATTER
# -----------------------------------------------------------------------------
[formatter_generic]
# Log message format
# %(levelname)s - Log level (INFO, WARNING, ERROR, etc.)
# %(name)s - Logger name
# %(message)s - The actual log message
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

# =============================================================================
# POST-WRITE HOOKS (OPTIONAL)
# =============================================================================
# Hooks that run after generating a migration file
# Useful for auto-formatting with black/ruff

# Uncomment to enable auto-formatting of new migrations:
# [post_write_hooks]
# hooks = ruff, black
# 
# [post_write_hooks.ruff]
# type = exec
# executable = ruff
# options = check --fix REVISION_SCRIPT_FILENAME
# 
# [post_write_hooks.black]
# type = exec
# executable = black
# options = REVISION_SCRIPT_FILENAME
